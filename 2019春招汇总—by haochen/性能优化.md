1.**CSRF攻击**

内容：1.B网站向A网站请求，带A网站的cookies，不访问A网站的前端，referer为B网站

防御：1.禁止第三方网站带cookies 新增属性SameSite（strict:任何请求都不能带和Lax允许链接带，ajax和表单提交都不能带cookie）但是只有chrome兼容，兼容性不好

2.生成验证码

3.带上token，表单利用一个type为hidden的表单进行，或者利用一个meta标签进行存放token

4.验证http的referer禁止第三方网站的请求

2.**cookies用户登录验证**

1.用户id 2.用户id+签名(进行加密验证)  3.session（cookie中没有任何用户信息，只是一个信息的钥匙）

xss可能偷取cookies：http-only的cookies不会被偷

cookies安全策略：签名防被篡改，私有变换加密，http-only防止xss，secure https下防止窃听

3.**点击劫持**

目标网站作为一个iframe嵌入到攻击者网站中。将iframe在视觉上进行隐藏，也就是将其透明度设置为0.对用户进行点击引导。用户亲手操作，不知情，iframe的透明度设置为0。

防范：

1.使用JavaScript禁止内嵌。

如果确确实实是一个真实的目标网站，那么top == window，top.location==window.location。如果是一个攻击者的网站，那么top指向的是主文档，也就是外面的那层window，而window指向的是iframe本身。top 不等于 window。top.location不等于window.location。如果发现不相等就触发跳转。top.location跳转到window.location。但是如果攻击者的页面禁掉了脚本，允许提交表单，就不会有作用了。sandbox

2.设置X-FRAME-OPTIONS头禁止内嵌（相当好的措施，兼容性好)

3.加入验证码等辅助手段。

4.**HTTP传输窃听**

http本身是明文的。窃听。篡改：1.插入广告 2.重定向的网站 3.无法防御的XSS和CSRF攻击

HTTPS利用TLS协议之上的协议。

但是会有一个问题，可能出现出现一个中间人，对浏览器而言他是一个服务器，对服务器而言它是一个浏览器，会将服务器的数据进行解密然后进行加密给浏览器。浏览器的数据也进行解密并且进行加密给服务器。需要引入一个证书机制。

如何确定服务器身份：浏览器、服务器和CA（数字证书中心：分发证书）

1.浏览器中内嵌了一个内置信任列表

2.服务器向CA申请证书。CA验证域名，并发放证书。

3.浏览器发送请求到服务器，服务器出具证书

4.浏览器验证证书，验证通过进行通信。

保证安全的原则：证书无法伪造，证书私钥不被泄漏，域名管理权不泄露（验证过程域名被控制，假服务器获得证书），CA坚守原则

5.**对称加密和非对称加密**

对称加密：通讯的数据都用同一套密钥进行加密解密

优点：简单快捷，密钥短，破译困难

缺点：用户多难管理，密钥的泄漏和更换的问题，无法验证发送者和接收者的身份

非对称加密：加密和解密使用的是两套不同的算法。

好处：机密性好，消除了交换密钥的需要

缺点：算法强度复杂，安全性依赖于算法，加密解密的速度没有对称的快。密钥管理方便。

HTTPS握手过程：

1. 首先，客户端 A 访问服务器 B ，比如我们用浏览器打开一个网页 [https://www.baidu.com](https://www.baidu.com/) ，这时，浏览器就是客户端 A ，百度的服务器就是服务器 B 了。这时候客户端 A 会生成一个随机数1，把随机数1 、自己支持的 SSL 版本号以及加密算法等这些信息告诉服务器 B 。
2. 服务器 B 知道这些信息后，然后确认一下双方的加密算法，然后服务端也生成一个随机数 B ，并将随机数 B 和 CA 颁发给自己的证书一同返回给客户端 A 。
3. 客户端 A 得到 CA 证书后，会去校验该 CA 证书的有效性，校验方法在上面已经说过了。校验通过后，客户端生成一个随机数3 ，然后用证书中的公钥加密随机数3 并传输给服务端 B 。
4. 服务端 B 得到加密后的随机数3，然后利用私钥进行解密，得到真正的随机数3。
5. 最后，客户端 A 和服务端 B 都有随机数1、随机数2、随机数3，然后双方利用这三个随机数生成一个对话密钥。之后传输内容就是利用对话密钥来进行加解密了。这时就是利用了对称加密，一般用的都是 AES 算法。
6. 客户端 A 通知服务端 B ，指明后面的通讯用对话密钥来完成，同时通知服务器 B 客户端 A 的握手过程结束。
7. 服务端 B 通知客户端 A，指明后面的通讯用对话密钥来完成，同时通知客户端 A 服务器 B 的握手过程结束。
8. SSL 的握手部分结束，SSL 安全通道的数据通讯开始，客户端 A 和服务器 B 开始使用相同的对话密钥进行数据通讯。
9. 在 TLS 握手阶段，两端使用非对称加密的方式来通信，但是因为非对称加密损耗的性能比对称加密大，所以在正式传输数据时，两端使用对称加密的方式通信。

有中间人攻击的风险：

 服务器向客户端发送公钥。
 攻击者截获公钥，保留在自己手上。
 然后攻击者自己生成一个【伪造的】公钥，发给客户端。
 客户端收到伪造的公钥后，生成加密hash值发给服务器。
 攻击者获得加密hash值，用自己的私钥解密获得真秘钥。
 同时生成假的加密hash值，发给服务器。
 服务器用私钥解密获得假秘钥。

中间人攻击一般发生在SSL握手协议中，协商密钥的时候（非对称加密阶段），而且发生中间人攻击，也就是代表攻击方拿到了证书的公钥和私钥。一旦会话初始化完成，开始进行数据通讯（对称加密阶段），想要完成中间人攻击是非常困难的。

防御中间人攻击的手段是做好证书的校验

https加密是在传输层





